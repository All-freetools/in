<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Background Remover | Free Tool Site</title>
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.4.2/css/all.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.4.5/dist/index.js"></script>

    <style>
        :root {
            --primary: #3b82f6;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --border: rgba(255, 255, 255, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--dark-bg); color: #e2e8f0; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .tool-container { background: var(--card-bg); width: 100%; max-width: 850px; border-radius: 24px; padding: 40px; border: 1px solid var(--border); text-align: center; position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .back-home { position: absolute; top: 20px; left: 20px; text-decoration: none; color: #94a3b8; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .upload-area { border: 2px dashed #334155; border-radius: 16px; padding: 60px 20px; cursor: pointer; background: rgba(255,255,255,0.02); margin: 30px 0; }
        .transparent-bg { background-image: linear-gradient(45deg, #2a3441 25%, transparent 25%), linear-gradient(-45deg, #2a3441 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #2a3441 75%), linear-gradient(-45deg, transparent 75%, #2a3441 75%); background-size: 20px 20px; border-radius: 12px; padding: 10px; }
        .result-container { display: none; margin-top: 20px; }
        img { max-width: 100%; border-radius: 8px; }
        .loader-container { display: none; margin: 20px 0; }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn { padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; margin: 10px; text-decoration: none; display: inline-block; }
        .btn-download { background: var(--primary); color: white; }
    </style>
</head>
<body>

    <div class="tool-container">
        <a href="index.html" class="back-home"><i class="fa-solid fa-arrow-left"></i> Back Home</a>

        <h1 style="margin-top:20px;">AI Background Remover</h1>
        <p style="color:#94a3b8">On-Device AI (GitHub Compatible Mode)</p>

        <div class="upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
            <i class="fa-solid fa-image" style="font-size: 50px; color: var(--primary); margin-bottom: 15px;"></i>
            <h3>Click to Upload Image</h3>
            <input type="file" id="fileInput" hidden accept="image/*">
        </div>

        <div class="loader-container" id="loader">
            <div class="spinner"></div>
            <p id="status">Loading AI Engine... (First time may take a few seconds)</p>
        </div>

        <div class="result-container" id="resultArea">
            <div class="transparent-bg">
                <img id="outputImage" src="" alt="Result">
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-download" id="downloadBtn"><i class="fa-solid fa-download"></i> Download Result</button>
                <button class="btn" onclick="location.reload()" style="background:#334155; color:white;">Try Another</button>
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const loader = document.getElementById('loader');
        const resultArea = document.getElementById('resultArea');
        const outputImage = document.getElementById('outputImage');
        const statusText = document.getElementById('status');
        const dropZone = document.getElementById('dropZone');

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            dropZone.style.display = 'none';
            loader.style.display = 'block';

            try {
                // Modified for better compatibility
                const config = {
                    publicPath: "https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.4.5/dist/",
                    progress: (status, progress) => {
                        statusText.innerText = `${status.replace('_', ' ')}... ${Math.round(progress * 100)}%`;
                    }
                };

                const blob = await imglyRemoveBackground(file, config);
                const url = URL.createObjectURL(blob);
                
                outputImage.src = url;
                loader.style.display = 'none';
                resultArea.style.display = 'block';

                document.getElementById('downloadBtn').onclick = () => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'removed-bg.png';
                    a.click();
                };
            } catch (error) {
                console.error(error);
                alert("Processing failed. This usually happens on mobile browsers with limited RAM or GitHub's security block. Please try on a Desktop.");
                location.reload();
            }
        });
    </script>
</body>
</html>
